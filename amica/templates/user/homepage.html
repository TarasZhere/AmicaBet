{% extends 'user/layout.html' %}
<!-- title -->
{% block title %} Homepage - AmicaBet {% endblock %}
<!--  -->
<!-- importing bet.macro.html -->
{% from "user/macros/bet.macro.html" import bet with context %}
<!--  -->
{% from "user/macros/friend.macro.html" import friend with context %}
<!--  -->
{% block content %}
<!-- content -->
<div class="container-fluid row justify-content-evenly mx-0">
    <!-- profile info -->
    <script>
        function accept(Uid) {
            const Http = new XMLHttpRequest();
            const url = '{{url_for("friend.accept")}}';

            Http.open("POST", url);
            Http.setRequestHeader("Content-type", "application/json");

            Http.send(JSON.stringify({ sender_Uid: Uid }));

            Http.onreadystatechange = (e) => {
                console.log(Http.responseText);
                // Valish
                var element = document.getElementById(Uid + "-accept");
                element.style.opacity = "0";
                setTimeout(() => {
                    element.style.display = "none";
                }, 1000);
            };
        }

        function reject(Uid) {
            const Http = new XMLHttpRequest();
            const url = '{{url_for("friend.reject")}}';

            Http.open("POST", url);
            Http.setRequestHeader("Content-type", "application/json");

            Http.send(JSON.stringify({ sender_Uid: Uid }));

            Http.onreadystatechange = (e) => {
                console.log(Http.responseText);
                // Valish
                var element = document.getElementById(Uid + "-reject");
                element.style.opacity = "0";
                setTimeout(() => {
                    element.style.display = "none";
                }, 1000);
            };
        }
    </script>
    <div class="col-5 pt-0 hide-scrollbar overflow-scroll" style="height: 90vh">
        <div class="my-3 p-4 bg-white border rounded-5 text-center shadow">
            <h2 class="mb-3 text-left fw-bolder pb-2">Connections</h2>
            {% if friends %}
            <!--  -->
            {% for f in friends %}
            <!--  -->
            {{friend(f['Uid'], f['fname'], f['lname'],f['email'], f['status'])}}
            <!--  -->
            {% endfor %}
            <!--  -->
            {% else %}
            <div class="fs-6 mb-2">
                No friends yet! Search for some. Top right button!
            </div>
            <img
                width="200"
                src="{{url_for('static', filename='imgs/add_friends.svg')}}"
            />
            {% endif %}
        </div>
    </div>
    <!-- Posts -->
    <div
        class="col-md-7 pt-0 pb-3 hide-scrollbar overflow-scroll"
        style="height: 90vh"
    >
        <div class="mt-3 card rounded-5 overflow-hidden" style="height: 180px">
            <video autoplay loop muted class="card-img rounded-5 img-fluid">
                <source
                    src="{{url_for('static', filename='animation/space.mp4')}}"
                    type="video/mp4"
                />
            </video>
            <div
                class="card-img-overlay text-light d-flex flex-column justify-content-center text-center"
            >
                <h2 class="card-title fw-bolder">Welcome!</h2>
                <p class="card-text">
                    Your bets are displayed bellow, as well as your friends.
                </p>
            </div>
        </div>
        <div class="bg-white rounded-5 p-3 mt-2 ,b-3 text-center border shadow">
            <div class="d-flex flex-wrap gap-2 mb-2 justify-content-center">
                <a
                    type="button"
                    href="{{url_for('user.homepage')}}"
                    class="btn btn-outline-primary shadow-sm"
                    >All</a
                >
                <a
                    type="button"
                    href="{{url_for('user.homepage') + 'pending'}}"
                    class="btn btn-outline-secondary shadow-sm"
                >
                    Pending
                </a>
                <a
                    type="button"
                    href="{{url_for('user.homepage') + 'partecipate'}}"
                    class="btn btn-outline-success shadow-sm"
                >
                    Partecipate
                </a>
                <a
                    type="button"
                    href="{{url_for('user.homepage') + 'rejected'}}"
                    class="btn btn-outline-danger shadow-sm"
                >
                    Rejected
                </a>
                <a
                    type="button"
                    href="{{url_for('user.homepage') + 'won'}}"
                    class="btn btn-outline-warning shadow-sm"
                    >Won</a
                >
                <a
                    type="button"
                    href="{{url_for('user.homepage') + 'lost'}}"
                    class="btn btn-outline-dark shadow-sm"
                    >Lost</a
                >
            </div>
            {% if bets %}
            <!--  -->
            {% for bet in bets %}
            <!--  -->
            {{bet(bet)}}
            <!--  -->
            {% endfor %}
            <!--  -->
            {% else %}
            <!--  -->
            <div class="fs-4">Nothing here yet! Challenge some friends!</div>
            <img
                width="300"
                src="{{url_for('static', filename='imgs/add_post.png')}}"
            />
        </div>
        <!--  -->
        {% endif %}
        <!--  -->
    </div>
</div>
{% endblock %}
