{% extends 'user/layout.html' %}
<!-- title -->
{% block title %} Homepage - AmicaBet {% endblock %}
<!-- importing bet.macro.html -->
{% from "user/macros/bet.macro.html" import bet with context %}

<!--  -->
<!--  -->
{% block content %}

<div
    class="container-sm d-flex flex-wrap justify-content-evenly align-items-center"
>
    <div class="align-self-start">
        <!-- Title start betting now in large and blue font centered bold -->
        <div class="rounded-4 shadow-lg bg-white">
            <h1 class="pt-3 px-3 my-3 display-6 fw-bolder text-primary">
                {{user.fname|capitalize}}, start betting now!
            </h1>
            <form
                class="px-3 py-3"
                action="{{url_for('bet.create')}}"
                method="POST"
            >
                <div class="row">
                    <div class="col">
                        <div class="form-floating mb-3">
                            <input
                                id="title"
                                required
                                name="title"
                                type="text"
                                class="form-control"
                                placeholder="Enter title"
                            />
                            <label for="title">Title</label>
                        </div>
                    </div>
                    <div class="col">
                        <div class="form-floating mb-3">
                            <input
                                required
                                name="ticket"
                                type="number"
                                min="2"
                                id="ticket"
                                placeholder="40"
                                class="form-control"
                            />
                            <label for="ticket">Ticket</label>
                        </div>
                    </div>
                </div>

                <div class="form-floating mb-3">
                    <select
                        required
                        name="invited_Uid"
                        class="form-select"
                        id="friends"
                    >
                        <option value="" selected>Choose...</option>
                        {% for f in friends %} {% if f.status == "accepted" %}

                        <option value="{{f['Uid']}}">
                            {{f['fname'] | capitalize }} {{f['lname'] |
                            capitalize}} | {{f['email']}}
                        </option>
                        {% endif %} {% endfor %}
                    </select>
                    <label for="friends">Friends</label>
                </div>
                <div class="form-floating mb-3">
                    <textarea
                        id="description"
                        name="description"
                        class="form-control"
                        placeholder="Adda description"
                    ></textarea>
                    <label for="description">Description</label>
                </div>
                <div class="d-flex flex-row align-items-center">
                    <!-- flash messages appera here -->
                    {% with messages =
                    get_flashed_messages(with_categories=true) %} {% if messages
                    %}
                    <div class="z-3 position-absolute bottom-0 end-0 mb-3 me-3">
                        {% for category, message in messages %}
                        <div
                            class="alert alert-{{category}} alert-dismissible fade show"
                        >
                            {{message}}
                            <button
                                type="button"
                                class="btn-close"
                                data-bs-dismiss="alert"
                                aria-label="Close"
                            ></button>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %} {% endwith %}
                    <button
                        type="submit"
                        class="btn btn-lg btn-success align-self-start ms-auto w-25"
                    >
                        Bet
                    </button>
                </div>
            </form>
        </div>
        <div
            class="position-absolute bottom-0 end-0"
            style="z-index: -1; width: 50%; height: 75%"
        >
            <img
                src="{{url_for('static', filename='imgs/winners.svg')}}"
                class="img-fluid"
                alt="winner"
            />
        </div>
    </div>
    <!-- display all bets -->
    <style>
        .bg-glass {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }
        .hide-scroll::-webkit-scrollbar {
            display: none;
        }
    </style>
    <div
        style="max-height: 85vh"
        class="mt-3 bg-glass p-3 d-flex flex-column rounded-4 shadow-lg"
    >
        <div class="d-flex flex-wrap gap-2 mb-2 justify-content-center">
            <a
                type="button"
                href="{{url_for('user.homepage')}}"
                class="btn btn-primary shadow-sm"
                >All</a
            >
            <a
                type="button"
                href="{{url_for('user.homepage') + 'pending'}}"
                class="btn btn-secondary shadow-sm"
            >
                Pending
            </a>
            <a
                type="button"
                href="{{url_for('user.homepage') + 'partecipate'}}"
                class="btn btn-success shadow-sm"
            >
                Partecipating
            </a>
            <a
                type="button"
                href="{{url_for('user.homepage') + 'rejected'}}"
                class="btn btn-danger shadow-sm"
            >
                Rejected
            </a>
            <a
                type="button"
                href="{{url_for('user.homepage') + 'won'}}"
                class="btn btn-warning shadow-sm"
                >Won</a
            >
            <a
                type="button"
                href="{{url_for('user.homepage') + 'lost'}}"
                class="btn btn-dark shadow-sm"
                >Lost</a
            >
        </div>
        <!-- Posts -->
        <div class="mt-2 text-center hide-scroll overflow-y-scroll">
            {% if bets %}
            <!--  -->
            <div class="d-flex flex-column justify-content-center w-100">
                {% for b in bets %}
                <!--  -->
                {{bet(b.Bid, b.title, b.description, b.ticket, b.Uid,
                b.invited_Uid, b.status, b.created_at)}}
                <!--  -->
                {% endfor %}
            </div>
            <!--  -->
            {% else %}
            <!-- allert saying there are no bets here to see -->

            <div class="d-flex justify-content-center h-100 align-items-center">
                <div class="alert alert-warning" role="alert">
                    There are no bets here to see yet!
                    <br />
                    Create some now!
                </div>
            </div>
        </div>

        <!--  -->
        {% endif %}
        <!--  -->
    </div>

    <script>
        function acceptBet(Bid) {
            fetch('{{url_for("bet.accept")}}/' + Bid, {
                method: "GET",
            })
                .then((res) => {
                    console.log(res);
                    location.reload();
                })
                .catch((err) => console.log(err));
        }

        function rejectBet(Bid) {
            fetch('{{url_for("bet.reject")}}/' + Bid, {
                method: "GET",
            })
                .then((res) => {
                    console.log(res);
                    location.reload();
                })
                .catch((err) => console.log(err));
        }

        function vote(Bid, voted_Uid) {
            const url = '{{url_for("vote.vote")}}';
            const options = {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    // 'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: JSON.stringify({
                    Bid,
                    voted_Uid,
                }),
            };

            fetch(url, options)
                .then((res) => {
                    console.log(res);
                })
                .catch((err) => {
                    console.log(err);
                });
            location.reload();
        }
    </script>
</div>

<!-- close block -->
{% endblock %}
